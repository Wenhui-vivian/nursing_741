<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Taking It To The Next Level | Intro To dplyr</title>
  <meta name="description" content="An Intro to data manipulation with dplyr" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Taking It To The Next Level | Intro To dplyr" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An Intro to data manipulation with dplyr" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Taking It To The Next Level | Intro To dplyr" />
  
  <meta name="twitter:description" content="An Intro to data manipulation with dplyr" />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-01-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="your-turn.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro To dplyr</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> R Data Structures</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#vectors"><i class="fa fa-check"></i><b>1.1</b> Vectors</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-frames"><i class="fa fa-check"></i><b>1.2</b> Data Frames</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#a-reference-data-frame"><i class="fa fa-check"></i><b>1.3</b> A Reference Data Frame</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#relation-to-dplyr"><i class="fa fa-check"></i><b>1.4</b> Relation to dplyr</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="digging-in.html"><a href="digging-in.html"><i class="fa fa-check"></i><b>2</b> Digging In</a><ul>
<li class="chapter" data-level="2.1" data-path="digging-in.html"><a href="digging-in.html#structure"><i class="fa fa-check"></i><b>2.1</b> Structure</a></li>
<li class="chapter" data-level="2.2" data-path="digging-in.html"><a href="digging-in.html#meta-information"><i class="fa fa-check"></i><b>2.2</b> Meta Information</a></li>
<li class="chapter" data-level="2.3" data-path="digging-in.html"><a href="digging-in.html#printing"><i class="fa fa-check"></i><b>2.3</b> Printing</a></li>
<li class="chapter" data-level="2.4" data-path="digging-in.html"><a href="digging-in.html#accessing-rows-and-columns"><i class="fa fa-check"></i><b>2.4</b> Accessing Rows And Columns</a></li>
<li class="chapter" data-level="2.5" data-path="digging-in.html"><a href="digging-in.html#interrogation"><i class="fa fa-check"></i><b>2.5</b> Interrogation</a></li>
<li class="chapter" data-level="2.6" data-path="digging-in.html"><a href="digging-in.html#missing-values"><i class="fa fa-check"></i><b>2.6</b> Missing values</a></li>
<li class="chapter" data-level="2.7" data-path="digging-in.html"><a href="digging-in.html#continuous-vs-factors"><i class="fa fa-check"></i><b>2.7</b> Continuous vs Factors</a></li>
<li class="chapter" data-level="2.8" data-path="digging-in.html"><a href="digging-in.html#sorting-data"><i class="fa fa-check"></i><b>2.8</b> Sorting data</a></li>
<li class="chapter" data-level="2.9" data-path="digging-in.html"><a href="digging-in.html#reading-csv-files"><i class="fa fa-check"></i><b>2.9</b> Reading CSV Files</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-tidyverse.html"><a href="the-tidyverse.html"><i class="fa fa-check"></i><b>3</b> The tidyverse</a><ul>
<li class="chapter" data-level="3.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#installing"><i class="fa fa-check"></i><b>3.1</b> Installing</a></li>
<li class="chapter" data-level="3.2" data-path="the-tidyverse.html"><a href="the-tidyverse.html#dplyr-basics"><i class="fa fa-check"></i><b>3.2</b> dplyr Basics</a></li>
<li class="chapter" data-level="3.3" data-path="the-tidyverse.html"><a href="the-tidyverse.html#first-steps"><i class="fa fa-check"></i><b>3.3</b> First Steps</a><ul>
<li class="chapter" data-level="3.3.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#filter"><i class="fa fa-check"></i><b>3.3.1</b> filter()</a></li>
<li class="chapter" data-level="3.3.2" data-path="the-tidyverse.html"><a href="the-tidyverse.html#mutate"><i class="fa fa-check"></i><b>3.3.2</b> mutate()</a></li>
<li class="chapter" data-level="3.3.3" data-path="the-tidyverse.html"><a href="the-tidyverse.html#arrange"><i class="fa fa-check"></i><b>3.3.3</b> arrange()</a></li>
<li class="chapter" data-level="3.3.4" data-path="the-tidyverse.html"><a href="the-tidyverse.html#select"><i class="fa fa-check"></i><b>3.3.4</b> select()</a></li>
<li class="chapter" data-level="3.3.5" data-path="the-tidyverse.html"><a href="the-tidyverse.html#group_by"><i class="fa fa-check"></i><b>3.3.5</b> group_by()</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="split-apply-combine.html"><a href="split-apply-combine.html"><i class="fa fa-check"></i><b>4</b> Split Apply Combine</a><ul>
<li class="chapter" data-level="4.1" data-path="split-apply-combine.html"><a href="split-apply-combine.html#what-are-pipes"><i class="fa fa-check"></i><b>4.1</b> What Are Pipes ?</a></li>
<li class="chapter" data-level="4.2" data-path="split-apply-combine.html"><a href="split-apply-combine.html#using-pipes-to-do-split-apply-combine"><i class="fa fa-check"></i><b>4.2</b> Using Pipes To Do Split-Apply-Combine</a><ul>
<li class="chapter" data-level="4.2.1" data-path="split-apply-combine.html"><a href="split-apply-combine.html#saving-results"><i class="fa fa-check"></i><b>4.2.1</b> Saving Results</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="split-apply-combine.html"><a href="split-apply-combine.html#an-example"><i class="fa fa-check"></i><b>4.3</b> An Example</a></li>
<li class="chapter" data-level="4.4" data-path="split-apply-combine.html"><a href="split-apply-combine.html#working-with-flowers"><i class="fa fa-check"></i><b>4.4</b> Working With Flowers</a><ul>
<li class="chapter" data-level="4.4.1" data-path="split-apply-combine.html"><a href="split-apply-combine.html#structure-of-the-data-frame"><i class="fa fa-check"></i><b>4.4.1</b> Structure of The Data frame</a></li>
<li class="chapter" data-level="4.4.2" data-path="split-apply-combine.html"><a href="split-apply-combine.html#more-practice"><i class="fa fa-check"></i><b>4.4.2</b> More Practice</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="your-turn.html"><a href="your-turn.html"><i class="fa fa-check"></i><b>5</b> Your Turn</a></li>
<li class="chapter" data-level="6" data-path="taking-it-to-the-next-level.html"><a href="taking-it-to-the-next-level.html"><i class="fa fa-check"></i><b>6</b> Taking It To The Next Level</a><ul>
<li class="chapter" data-level="6.0.1" data-path="taking-it-to-the-next-level.html"><a href="taking-it-to-the-next-level.html#inspecting-the-data"><i class="fa fa-check"></i><b>6.0.1</b> Inspecting the Data</a></li>
<li class="chapter" data-level="6.1" data-path="taking-it-to-the-next-level.html"><a href="taking-it-to-the-next-level.html#creating-categories"><i class="fa fa-check"></i><b>6.1</b> Creating Categories</a></li>
<li class="chapter" data-level="6.2" data-path="taking-it-to-the-next-level.html"><a href="taking-it-to-the-next-level.html#lets-do-some-summarization"><i class="fa fa-check"></i><b>6.2</b> Let’s Do Some Summarization</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro To dplyr</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="taking-it-to-the-next-level" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Taking It To The Next Level</h1>
<p>Here we look at some data obtained from the City of Chicago Open Data Portal <a href="https://data.cityofchicago.org/" class="uri">https://data.cityofchicago.org/</a>. This is data that represents phone calls to the police during the year of 2012. Just pick a folder on your hard drive and download the data.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/steviep42/nursing_741/master/chi_crimes.csv&quot;</span></a>
<a class="sourceLine" id="cb119-2" data-line-number="2"></a>
<a class="sourceLine" id="cb119-3" data-line-number="3"><span class="kw">download.file</span>(url,<span class="st">&quot;chi_crimes.csv&quot;</span>)</a></code></pre></div>
<p>Next, read the file in to a local data frame:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1">chi &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;chi_crimes.csv&quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   ID = col_double(),
##   Arrest = col_logical(),
##   Domestic = col_logical(),
##   Ward = col_double(),
##   `X Coordinate` = col_double(),
##   `Community Area` = col_double(),
##   `Y Coordinate` = col_double(),
##   Year = col_double(),
##   Latitude = col_double(),
##   Longitude = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div id="inspecting-the-data" class="section level3">
<h3><span class="header-section-number">6.0.1</span> Inspecting the Data</h3>
<p>The way the data is organzied is that each row represents a call to the police which may or may not result in an actual arrest. In any case there will be a case number assigned to the call and other information such as the Best, Ward, Block, and Community Area will be noted. If there is an arrest it will be recorded and then it will be categorized according to an FBI code. The location of the call will be recorded in latitude and longitude. Some basic questions might be how many rows and columns there are, etc</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">glimpse</span>(chi)</a></code></pre></div>
<pre><code>## Observations: 334,141
## Variables: 22
## $ `Case Number`          &lt;chr&gt; &quot;HV530781&quot;, &quot;HV532227&quot;, &quot;HV531513&quot;, &quot;HV53…
## $ ID                     &lt;dbl&gt; 8856945, 8858652, 8858725, 8857128, 88575…
## $ Date                   &lt;chr&gt; &quot;10/23/2012 10:10:00 AM&quot;, &quot;10/23/2012 10:…
## $ Block                  &lt;chr&gt; &quot;040XX W LAKE ST&quot;, &quot;001XX W WASHINGTON ST…
## $ IUCR                   &lt;chr&gt; &quot;1210&quot;, &quot;0870&quot;, &quot;0930&quot;, &quot;4387&quot;, &quot;0890&quot;, &quot;…
## $ `Primary Type`         &lt;chr&gt; &quot;DECEPTIVE PRACTICE&quot;, &quot;THEFT&quot;, &quot;MOTOR VEH…
## $ Description            &lt;chr&gt; &quot;THEFT OF LABOR/SERVICES&quot;, &quot;POCKET-PICKIN…
## $ `Location Description` &lt;chr&gt; &quot;CTA PLATFORM&quot;, &quot;CTA TRAIN&quot;, &quot;STREET&quot;, &quot;A…
## $ Arrest                 &lt;lgl&gt; TRUE, FALSE, FALSE, TRUE, FALSE, FALSE, F…
## $ Domestic               &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, …
## $ Beat                   &lt;chr&gt; &quot;1114&quot;, &quot;0122&quot;, &quot;1523&quot;, &quot;0221&quot;, &quot;0331&quot;, &quot;…
## $ District               &lt;chr&gt; &quot;011&quot;, &quot;001&quot;, &quot;015&quot;, &quot;002&quot;, &quot;003&quot;, &quot;020&quot;,…
## $ Ward                   &lt;dbl&gt; 28, 42, 37, 4, 5, 46, 27, 16, 24, 9, 17, …
## $ `FBI Code`             &lt;chr&gt; &quot;11&quot;, &quot;06&quot;, &quot;07&quot;, &quot;26&quot;, &quot;06&quot;, &quot;14&quot;, &quot;06&quot;,…
## $ `X Coordinate`         &lt;dbl&gt; 1149614, 1175486, 1139375, 1182893, 11917…
## $ `Community Area`       &lt;dbl&gt; 26, 32, 25, 39, 43, 3, 23, 66, 26, 50, 67…
## $ `Y Coordinate`         &lt;dbl&gt; 1901481, 1900854, 1903385, 1875958, 18592…
## $ Year                   &lt;dbl&gt; 2012, 2012, 2012, 2012, 2012, 2012, 2012,…
## $ Latitude               &lt;dbl&gt; 41.88558, 41.88332, 41.89100, 41.81483, 4…
## $ `Updated On`           &lt;chr&gt; &quot;10/25/2012 12:41:06 AM&quot;, &quot;10/29/2012 12:…
## $ Longitude              &lt;dbl&gt; -87.72605, -87.63106, -87.76360, -87.6046…
## $ Location               &lt;chr&gt; &quot;(41.885581598748246, -87.72604656914372)…</code></pre>
<p>So let’s check this data frame out some more. For example, what are the factors in this data frame ? Those that take on only a few different values might be good summary variables.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(n_distinct)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 22
##   `Case Number`     ID   Date Block  IUCR `Primary Type` Description
##           &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;          &lt;int&gt;       &lt;int&gt;
## 1        334114 334139 121484 28383   358             30         296
## # … with 15 more variables: `Location Description` &lt;int&gt;, Arrest &lt;int&gt;,
## #   Domestic &lt;int&gt;, Beat &lt;int&gt;, District &lt;int&gt;, Ward &lt;int&gt;, `FBI
## #   Code` &lt;int&gt;, `X Coordinate` &lt;int&gt;, `Community Area` &lt;int&gt;, `Y
## #   Coordinate` &lt;int&gt;, Year &lt;int&gt;, Latitude &lt;int&gt;, `Updated On` &lt;int&gt;,
## #   Longitude &lt;int&gt;, Location &lt;int&gt;</code></pre>
<p>From viewing thism perhaps variables like Arrest, Domestic, FBI Code, District, and Ward could be good summary variables. We don’t really have any kind of measured data here.</p>
<p>We do have lots of dates which at this point are actually character strings so let’s turn them into dates and then work with them to get some more summary variables created. There are also some latitude and longitude information that we perhaps later use to draw some maps if we want. We’ll consider that later.</p>
</div>
<div id="creating-categories" class="section level2">
<h2><span class="header-section-number">6.1</span> Creating Categories</h2>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(lubridate))</a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="co"># Right now the dates and times are just a character string</span></a>
<a class="sourceLine" id="cb127-3" data-line-number="3"></a>
<a class="sourceLine" id="cb127-4" data-line-number="4"><span class="kw">str</span>(chi<span class="op">$</span>Date)  </a></code></pre></div>
<pre><code>##  chr [1:334141] &quot;10/23/2012 10:10:00 AM&quot; &quot;10/23/2012 10:00:00 AM&quot; ...</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="co"># Note that the dates have a PM or AM string. Let&#39;s exploit </span></a>
<a class="sourceLine" id="cb129-2" data-line-number="2"><span class="co"># that information to create a category that captures this information.</span></a>
<a class="sourceLine" id="cb129-3" data-line-number="3"></a>
<a class="sourceLine" id="cb129-4" data-line-number="4">chi &lt;-<span class="st"> </span>chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">am_pm=</span><span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&quot;PM&quot;</span>,Date),<span class="st">&quot;PM&quot;</span>,<span class="st">&quot;AM&quot;</span>)) </a>
<a class="sourceLine" id="cb129-5" data-line-number="5"></a>
<a class="sourceLine" id="cb129-6" data-line-number="6"><span class="co"># Let&#39;s turn them into actual dates and times using the lubridate package</span></a>
<a class="sourceLine" id="cb129-7" data-line-number="7"></a>
<a class="sourceLine" id="cb129-8" data-line-number="8">chi<span class="op">$</span>Date &lt;-<span class="st"> </span><span class="kw">parse_date_time</span>(chi<span class="op">$</span>Date,<span class="st">&#39;%m/%d/%Y %I:%M:%S %p&#39;</span>)</a>
<a class="sourceLine" id="cb129-9" data-line-number="9"></a>
<a class="sourceLine" id="cb129-10" data-line-number="10"><span class="kw">range</span>(chi<span class="op">$</span>Date)</a></code></pre></div>
<pre><code>## [1] &quot;2012-01-01 00:00:00 UTC&quot; &quot;2012-12-31 23:58:00 UTC&quot;</code></pre>
<p>It’s worth noting that we can use some functions from lubridate to further group the dates and times so we can do some more specific analysis. <a href="http://www.noamross.net/blog/2014/2/10/using-times-and-dates-in-r---presentation-code.html">Here</a> is link to a tutorial on lubridate. Anyway try some of these:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="co"># List the first 5 records from the chi data table</span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2">chi<span class="op">$</span>Date <span class="op">%&gt;%</span><span class="st"> </span>head</a></code></pre></div>
<pre><code>## [1] &quot;2012-10-23 10:10:00 UTC&quot; &quot;2012-10-23 10:00:00 UTC&quot;
## [3] &quot;2012-10-23 10:00:00 UTC&quot; &quot;2012-10-23 10:00:00 UTC&quot;
## [5] &quot;2012-10-23 10:00:00 UTC&quot; &quot;2012-10-23 10:00:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="co"># This will tell us what day of the week the given date and time represents</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2">chi<span class="op">$</span>Date <span class="op">%&gt;%</span><span class="st"> </span>weekdays <span class="op">%&gt;%</span><span class="st"> </span>head</a></code></pre></div>
<pre><code>## [1] &quot;Tuesday&quot; &quot;Tuesday&quot; &quot;Tuesday&quot; &quot;Tuesday&quot; &quot;Tuesday&quot; &quot;Tuesday&quot;</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="co"># This will tell us what month the date and time falls into</span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2">chi<span class="op">$</span>Date <span class="op">%&gt;%</span><span class="st"> </span>months <span class="op">%&gt;%</span><span class="st"> </span>head</a></code></pre></div>
<pre><code>## [1] &quot;October&quot; &quot;October&quot; &quot;October&quot; &quot;October&quot; &quot;October&quot; &quot;October&quot;</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="co"># Let&#39;s add a factor to the data table/data frame that gives the month</span></a>
<a class="sourceLine" id="cb137-2" data-line-number="2">chi &lt;-<span class="st"> </span>chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Month=</span><span class="kw">months</span>(Date)) </a>
<a class="sourceLine" id="cb137-3" data-line-number="3"></a>
<a class="sourceLine" id="cb137-4" data-line-number="4"><span class="kw">unique</span>(chi<span class="op">$</span>Month)</a></code></pre></div>
<pre><code>##  [1] &quot;October&quot;   &quot;September&quot; &quot;August&quot;    &quot;July&quot;      &quot;June&quot;     
##  [6] &quot;May&quot;       &quot;April&quot;     &quot;March&quot;     &quot;February&quot;  &quot;January&quot;  
## [11] &quot;November&quot;  &quot;December&quot;</code></pre>
</div>
<div id="lets-do-some-summarization" class="section level2">
<h2><span class="header-section-number">6.2</span> Let’s Do Some Summarization</h2>
<p>Let’s add in a few more factors based on the date since it will help us build some interesting tables as we try to understand the patterns in Chicago crime during the year of 2013. It is also important to understand how to work with dates since they wind up being important when looking at data. Not every data set will be a function of dates or be reliant upon them for interpretation but this one is.</p>
<p>It’s also not necessary to create these categories in advance or make them part of the data frame. We could do this on the fly as we will see later. We will create a category to classify the quarter during which the call to the police occurred.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">chi &lt;-<span class="st"> </span>chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">quarter=</span><span class="kw">quarter</span>(Date)) </a>
<a class="sourceLine" id="cb139-2" data-line-number="2"></a>
<a class="sourceLine" id="cb139-3" data-line-number="3">chi &lt;-<span class="st"> </span>chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">weekdays=</span><span class="kw">weekdays</span>(Date))</a>
<a class="sourceLine" id="cb139-4" data-line-number="4"></a>
<a class="sourceLine" id="cb139-5" data-line-number="5">chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Month, am_pm, weekdays, quarter) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   Month   am_pm weekdays quarter
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;      &lt;int&gt;
## 1 October AM    Tuesday        4
## 2 October AM    Tuesday        4
## 3 October AM    Tuesday        4
## 4 October AM    Tuesday        4
## 5 October AM    Tuesday        4
## 6 October AM    Tuesday        4</code></pre>
<p>Now we can start to ask some basic questions to better understand the data. When we have lots of categories in our data for which we could make some count-based summaries which gives us some frequencies. For example, let’s focus on the “Arrest” variable to figure out how many Arrests happened. What about the FBI codes ?</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="co"># This gives us a table of Arrests vs non-Arrests</span></a>
<a class="sourceLine" id="cb141-2" data-line-number="2"></a>
<a class="sourceLine" id="cb141-3" data-line-number="3">chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(Arrest)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   Arrest      n
##   &lt;lgl&gt;   &lt;int&gt;
## 1 FALSE  244210
## 2 TRUE    89931</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="co"># And we could see the count of reported crimes according to FBI code</span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2"></a>
<a class="sourceLine" id="cb143-3" data-line-number="3">chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(<span class="st">`</span><span class="dt">FBI Code</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 30 x 2
##    `FBI Code`     n
##    &lt;chr&gt;      &lt;int&gt;
##  1 06         73414
##  2 08B        52377
##  3 14         35837
##  4 18         33523
##  5 26         29268
##  6 05         22749
##  7 07         16372
##  8 08A        15261
##  9 03         13428
## 10 11         10884
## # … with 20 more rows</code></pre>
<p>Relative to the FBI codes I don’t know what the code actually mean but I found a description of them at <a href="http://gis.chicagopolice.org/clearmap_crime_sums/crime_types.html">this URL</a>
So it seems to me that the top 5 areas, at least by FBI codes, are:</p>
<ul>
<li>Larceny</li>
<li>Simple Battery</li>
<li>Vandalism</li>
<li>Drug Abuse</li>
<li>Misc Non-Index Offense</li>
</ul>
<p>We could do two-way table of course. This helps us look at relationships between categories. Here we look at how Arrests relate to whether it’s day or night. When do most arrests occur ?</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">chi <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(Arrest,am_pm) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb145-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(Arrest<span class="op">==</span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb145-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   Arrest am_pm     n
##   &lt;lgl&gt;  &lt;chr&gt; &lt;int&gt;
## 1 TRUE   PM    62229
## 2 TRUE   AM    27702</code></pre>
<p>So let’s plot a bar chart that shows is the total number of calls to the police for each month and what portion of those calls each monht resulted in an arrest.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">chi <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(Arrest,Month) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Month,<span class="dt">y=</span>n,<span class="dt">fill=</span>Arrest)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb147-4" data-line-number="4"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">45</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-5" data-line-number="5"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Calls To Police&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb147-6" data-line-number="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Chicago Arrests per Month in 2013&quot;</span>)</a></code></pre></div>
<p><img src="nursing_741_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="your-turn.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["nursing_741.pdf", "nursing_741.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
