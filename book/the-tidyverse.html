<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 The tidyverse | Intro To dplyr</title>
  <meta name="description" content="An Intro to data manipulation with dplyr" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 The tidyverse | Intro To dplyr" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An Intro to data manipulation with dplyr" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 The tidyverse | Intro To dplyr" />
  
  <meta name="twitter:description" content="An Intro to data manipulation with dplyr" />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-01-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="digging-in.html"/>
<link rel="next" href="methods.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro To dplyr</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> R Data Structures</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#vectors"><i class="fa fa-check"></i><b>1.1</b> Vectors</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-frames"><i class="fa fa-check"></i><b>1.2</b> Data Frames</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#a-reference-data-frame"><i class="fa fa-check"></i><b>1.3</b> A Reference Data Frame</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#relation-to-dplyr"><i class="fa fa-check"></i><b>1.4</b> Relation to dplyr</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="digging-in.html"><a href="digging-in.html"><i class="fa fa-check"></i><b>2</b> Digging In</a><ul>
<li class="chapter" data-level="2.1" data-path="digging-in.html"><a href="digging-in.html#structure"><i class="fa fa-check"></i><b>2.1</b> Structure</a></li>
<li class="chapter" data-level="2.2" data-path="digging-in.html"><a href="digging-in.html#meta-information"><i class="fa fa-check"></i><b>2.2</b> Meta Information</a></li>
<li class="chapter" data-level="2.3" data-path="digging-in.html"><a href="digging-in.html#printing"><i class="fa fa-check"></i><b>2.3</b> Printing</a></li>
<li class="chapter" data-level="2.4" data-path="digging-in.html"><a href="digging-in.html#accessing-rows-and-columns"><i class="fa fa-check"></i><b>2.4</b> Accessing Rows And Columns</a></li>
<li class="chapter" data-level="2.5" data-path="digging-in.html"><a href="digging-in.html#interrogation"><i class="fa fa-check"></i><b>2.5</b> Interrogation</a></li>
<li class="chapter" data-level="2.6" data-path="digging-in.html"><a href="digging-in.html#missing-values"><i class="fa fa-check"></i><b>2.6</b> Missing values</a></li>
<li class="chapter" data-level="2.7" data-path="digging-in.html"><a href="digging-in.html#continuous-vs-factors"><i class="fa fa-check"></i><b>2.7</b> Continuous vs Factors</a></li>
<li class="chapter" data-level="2.8" data-path="digging-in.html"><a href="digging-in.html#sorting-data"><i class="fa fa-check"></i><b>2.8</b> Sorting data</a></li>
<li class="chapter" data-level="2.9" data-path="digging-in.html"><a href="digging-in.html#reading-csv-files"><i class="fa fa-check"></i><b>2.9</b> Reading CSV Files</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-tidyverse.html"><a href="the-tidyverse.html"><i class="fa fa-check"></i><b>3</b> The tidyverse</a><ul>
<li class="chapter" data-level="3.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#installing"><i class="fa fa-check"></i><b>3.1</b> Installing</a></li>
<li class="chapter" data-level="3.2" data-path="the-tidyverse.html"><a href="the-tidyverse.html#dplyr-basics"><i class="fa fa-check"></i><b>3.2</b> dplyr Basics</a></li>
<li class="chapter" data-level="3.3" data-path="the-tidyverse.html"><a href="the-tidyverse.html#first-steps"><i class="fa fa-check"></i><b>3.3</b> First Steps</a><ul>
<li class="chapter" data-level="3.3.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#filter"><i class="fa fa-check"></i><b>3.3.1</b> filter()</a></li>
<li class="chapter" data-level="3.3.2" data-path="the-tidyverse.html"><a href="the-tidyverse.html#mutate"><i class="fa fa-check"></i><b>3.3.2</b> mutate()</a></li>
<li class="chapter" data-level="3.3.3" data-path="the-tidyverse.html"><a href="the-tidyverse.html#arrange"><i class="fa fa-check"></i><b>3.3.3</b> arrange()</a></li>
<li class="chapter" data-level="3.3.4" data-path="the-tidyverse.html"><a href="the-tidyverse.html#select"><i class="fa fa-check"></i><b>3.3.4</b> select()</a></li>
<li class="chapter" data-level="3.3.5" data-path="the-tidyverse.html"><a href="the-tidyverse.html#group_by"><i class="fa fa-check"></i><b>3.3.5</b> group_by()</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>4</b> Methods</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro To dplyr</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-tidyverse" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> The tidyverse</h1>
<p>The <strong>dplyr</strong> package is part of the larger <strong>tidyverse</strong> package set which has expanded considerably in recent years and continues to grow in size and utility such that many people never learn the “older way” of doing things in R. But we’ve already been through that in the previous section. The tidyverse has the following packages. The descriptions have been lifted from the <a href="https://www.tidyverse.org/packages/">tidyverse home page</a>.</p>
<p><strong>ggplot2</strong> - ggplot2 is a system for declaratively creating graphics, based on The Grammar of Graphics. You provide the data, tell ggplot2 how to map variables to aesthetics, what graphical primitives to use, and it takes care of the details.</p>
<p><strong>dplyr</strong> - dplyr provides a grammar of data manipulation, providing a consistent set of verbs that solve the most common data manipulation challenges.</p>
<p><strong>tidyr</strong> - tidyr provides a set of functions that help you get to tidy data. Tidy data is data with a consistent form: in brief, every variable goes in a column, and every column is a variable.</p>
<p><strong>readr</strong> - readr provides a fast and friendly way to read rectangular data (like csv, tsv, and fwf). It is designed to flexibly parse many types of data found in the wild, while still cleanly failing when data unexpectedly changes.</p>
<p><strong>tibble</strong> - tibble is a modern re-imagining of the data frame, keeping what time has proven to be effective, and throwing out what it has not. Tibbles are data.frames that are lazy and surly: they do less and complain more forcing you to confront problems earlier, typically leading to cleaner, more expressive code.</p>
<p><strong>stringr</strong> - stringr provides a cohesive set of functions designed to make working with strings as easy as possible. It is built on top of stringi, which uses the ICU C library to provide fast, correct implementations of common string manipulations.</p>
<p><strong>lubdriate</strong> - Date-time data can be frustrating to work with in R. R commands for date-times are generally unintuitive and change depending on the type of date-time object being used. Moreover, the methods we use with date-times must be robust to time zones, leap days, daylight savings times, and other time related quirks. Lubridate makes it easier to do the things R does with date-times and possible to do the things R does not.</p>
<div id="installing" class="section level2">
<h2><span class="header-section-number">3.1</span> Installing</h2>
<p>You will probably use a number of functions from several of these packages so it’s best to go ahead and install the entire <strong>tidyverse</strong> in one go. To install it, do one of the following:</p>
<ol style="list-style-type: decimal">
<li>At the R Console from within RStudio, type:</li>
</ol>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Use the Tools -&gt; Install Packages menu item in RStudio:</li>
</ol>
<p><img src="figures/inst.png" width="400" /></p>
<p>After you have installed the package you may load it by doing:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tidyverse))</a></code></pre></div>
<p>Note that the <strong>cheatsheet</strong> for <strong>dplyr</strong> can be <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf">found here</a></p>
<p><img src="figures/cheat.png" /></p>
</div>
<div id="dplyr-basics" class="section level2">
<h2><span class="header-section-number">3.2</span> dplyr Basics</h2>
<p><strong>dplyr</strong> is a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges. In fact if you were paying attention during the opening section on data frames you will have noticed that most of the activities we performed related to the following activires. In dplyr-speak there are the <strong>verbs</strong> that help us get work done.</p>
<pre><code>mutate() - adds new variables that are functions of existing variables
select() - picks variables based on their names.
filter() - picks cases based on their values.
summarise() - reduces multiple values down to a single summary.
arrange() - changes the ordering of the rows.</code></pre>
</div>
<div id="first-steps" class="section level2">
<h2><span class="header-section-number">3.3</span> First Steps</h2>
<p>Note that this material references <a href="https:%20//speakerdeck.com/dpastoor/becoming-a-data-ninja-with-dplyr">“Becoming a data ninja with dplyr”</a> as well as <a href="http://genomicsclass.github.io/book/pages/dplyr_tutorial.html">this dplyr tutorial</a></p>
<p>We’ll go back to the basics here by using a very small data frame which will make it clear how the various <strong>dplyr</strong> verbs actually work:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb98-2" data-line-number="2">                 <span class="dt">gender =</span> <span class="kw">c</span>(<span class="st">&quot;MALE&quot;</span>,<span class="st">&quot;MALE&quot;</span>,<span class="st">&quot;FEMALE&quot;</span>,<span class="st">&quot;MALE&quot;</span>,<span class="st">&quot;FEMALE&quot;</span>),</a>
<a class="sourceLine" id="cb98-3" data-line-number="3">                 <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">70</span>,<span class="dv">76</span>,<span class="dv">60</span>,<span class="dv">64</span>,<span class="dv">68</span>))</a></code></pre></div>
<p><img src="figures/df1.png" width="400" /></p>
<div id="filter" class="section level3">
<h3><span class="header-section-number">3.3.1</span> filter()</h3>
<p>The <strong>filter()</strong> function allows us to sift through the data frame to find rows that satisfy some logical condition. (With the older approach we would be using the bracket notation). The following example allows is to find only the observations relating to a declared gender of <strong>female</strong>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw">filter</span>(df,gender <span class="op">==</span><span class="st"> &quot;FEMALE&quot;</span>)</a></code></pre></div>
<pre><code>##   id gender age
## 1  3 FEMALE  60
## 2  5 FEMALE  68</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="co"># Given this data frame, the following is equivalent </span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2"></a>
<a class="sourceLine" id="cb101-3" data-line-number="3"><span class="kw">filter</span>(df, gender <span class="op">!=</span><span class="st"> &quot;MALE&quot;</span>)</a></code></pre></div>
<pre><code>##   id gender age
## 1  3 FEMALE  60
## 2  5 FEMALE  68</code></pre>
<p><img src="figures/df2.png" /></p>
<p>So, now find only the <strong>ids</strong> that relate to rows 1,3, or 5. This is a highly specialized search but it is helpful to show that you can use a wide variety of logical constructs.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">filter</span>(df, id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>))</a></code></pre></div>
<pre><code>##   id gender age
## 1  1   MALE  70
## 2  3 FEMALE  60
## 3  5 FEMALE  68</code></pre>
<p><img src="figures/df3.png" /></p>
</div>
<div id="mutate" class="section level3">
<h3><span class="header-section-number">3.3.2</span> mutate()</h3>
<p>Mutate is used to add or remove columns in a data frame. Let’s create a new column in the data frame that contains the mean value of the age column.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw">mutate</span>(df,<span class="dt">meanage =</span> <span class="kw">mean</span>(age))</a></code></pre></div>
<pre><code>##   id gender age meanage
## 1  1   MALE  70    67.6
## 2  2   MALE  76    67.6
## 3  3 FEMALE  60    67.6
## 4  4   MALE  64    67.6
## 5  5 FEMALE  68    67.6</code></pre>
<p><img src="figures/meanage.png" /></p>
<p>Next we will create a new column designed to tell us if a given observation has an age that is greater than or equal to the average age. Specifically, create a variable called <strong>old_young</strong> and assign a value of “Y” if the observed age for that row is above the mean age and a value of “N” if it is not.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">mutate</span>(df,<span class="dt">old_young=</span><span class="kw">ifelse</span>(df<span class="op">$</span>age<span class="op">&gt;=</span><span class="kw">mean</span>(df<span class="op">$</span>age),<span class="st">&quot;Y&quot;</span>,<span class="st">&quot;N&quot;</span>))</a></code></pre></div>
<pre><code>##   id gender age old_young
## 1  1   MALE  70         Y
## 2  2   MALE  76         Y
## 3  3 FEMALE  60         N
## 4  4   MALE  64         N
## 5  5 FEMALE  68         Y</code></pre>
<p>One way we could use something like this is in making a plot where the observations exhibiting an age value above the mean are plotted in a certain color and those below the mean are in another color.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1">tmp &lt;-<span class="st"> </span><span class="kw">mutate</span>(df, <span class="dt">color =</span> <span class="kw">ifelse</span>(age <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(age),<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>)) </a>
<a class="sourceLine" id="cb109-2" data-line-number="2"></a>
<a class="sourceLine" id="cb109-3" data-line-number="3"><span class="kw">plot</span>(tmp<span class="op">$</span>age,<span class="dt">col=</span>tmp<span class="op">$</span>color, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>,</a>
<a class="sourceLine" id="cb109-4" data-line-number="4">     <span class="dt">pch=</span><span class="dv">19</span>,<span class="dt">main=</span><span class="st">&quot;Ages&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Age&quot;</span>) </a>
<a class="sourceLine" id="cb109-5" data-line-number="5"></a>
<a class="sourceLine" id="cb109-6" data-line-number="6"><span class="kw">grid</span>()</a>
<a class="sourceLine" id="cb109-7" data-line-number="7"></a>
<a class="sourceLine" id="cb109-8" data-line-number="8"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(tmp<span class="op">$</span>age),<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb109-9" data-line-number="9"></a>
<a class="sourceLine" id="cb109-10" data-line-number="10"><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>,</a>
<a class="sourceLine" id="cb109-11" data-line-number="11">       <span class="kw">c</span>(<span class="st">&quot;Above Avg&quot;</span>,<span class="st">&quot;Below Avg&quot;</span>),<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>),<span class="dt">pch=</span><span class="dv">19</span>)</a></code></pre></div>
<p><img src="nursing_741_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
</div>
<div id="arrange" class="section level3">
<h3><span class="header-section-number">3.3.3</span> arrange()</h3>
<p>Use arrange for sorting the data frame by one or more columns. When using the basic data frame structure from R we had to use the <strong>order()</strong> function to help us generate a vector that has the row numbers of the data frame that correpsond to the desired order of display (lowest to highest, etc).</p>
<p>Let’s sort the data frame <strong>dff</strong> by age from oldest to youngest.
First we’ll use the older approach. While this will work, it is not exactly very intuitive.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">df[<span class="kw">rev</span>(<span class="kw">order</span>(df<span class="op">$</span>age)),]</a></code></pre></div>
<pre><code>##   id gender age
## 2  2   MALE  76
## 1  1   MALE  70
## 5  5 FEMALE  68
## 4  4   MALE  64
## 3  3 FEMALE  60</code></pre>
<p><strong>dplyr</strong> makes this process more simple - at least in my opinion</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">arrange</span>(df,<span class="kw">desc</span>(age))</a></code></pre></div>
<pre><code>##   id gender age
## 1  2   MALE  76
## 2  1   MALE  70
## 3  5 FEMALE  68
## 4  4   MALE  64
## 5  3 FEMALE  60</code></pre>
<p>Next, let’s sort <strong>df</strong> by gender (alphabetically) and then by age
from olderst to youngest. The rows relating to a gender of <strong>female</strong> are going to be listed first because, alphabetically speaking, the letter “F” comes before the letter “M”. Then within those categories we have the ages sorted from oldest to youngest.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1"><span class="kw">arrange</span>(df, gender,<span class="kw">desc</span>(age))</a></code></pre></div>
<pre><code>##   id gender age
## 1  5 FEMALE  68
## 2  3 FEMALE  60
## 3  2   MALE  76
## 4  1   MALE  70
## 5  4   MALE  64</code></pre>
<p>If we used the older approach it would look like the following. Ugh !</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">df[<span class="kw">order</span>(df<span class="op">$</span>gender,<span class="op">-</span>df<span class="op">$</span>age),]</a></code></pre></div>
<pre><code>##   id gender age
## 5  5 FEMALE  68
## 3  3 FEMALE  60
## 2  2   MALE  76
## 1  1   MALE  70
## 4  4   MALE  64</code></pre>
</div>
<div id="select" class="section level3">
<h3><span class="header-section-number">3.3.4</span> select()</h3>
<p>The select() functions allows us to select one or more columns from a data frame.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="co"># Reorder the columns</span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2"><span class="kw">select</span>(df,gender,id,age)  </a></code></pre></div>
<pre><code>##   gender id age
## 1   MALE  1  70
## 2   MALE  2  76
## 3 FEMALE  3  60
## 4   MALE  4  64
## 5 FEMALE  5  68</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="co"># Select all but the age column</span></a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="kw">select</span>(df,<span class="op">-</span>age)</a></code></pre></div>
<pre><code>##   id gender
## 1  1   MALE
## 2  2   MALE
## 3  3 FEMALE
## 4  4   MALE
## 5  5 FEMALE</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="co"># Can use the &quot;:&quot; operator to select a range</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="kw">select</span>(df,id<span class="op">:</span>age) </a></code></pre></div>
<pre><code>##   id gender age
## 1  1   MALE  70
## 2  2   MALE  76
## 3  3 FEMALE  60
## 4  4   MALE  64
## 5  5 FEMALE  68</code></pre>
<p>The select() function provides the ability to select by “regular expressions”&quot; or numeric patterns:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="co"># Select all columns that start with an &quot;a&quot;</span></a>
<a class="sourceLine" id="cb124-2" data-line-number="2"><span class="kw">select</span>(df,<span class="kw">starts_with</span>(<span class="st">&quot;a&quot;</span>))</a></code></pre></div>
<pre><code>##   age
## 1  70
## 2  76
## 3  60
## 4  64
## 5  68</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw">names</span>(mtcars)</a></code></pre></div>
<pre><code>##  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;
## [11] &quot;carb&quot;</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="co"># Get only columns that start with &quot;c&quot;</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2"></a>
<a class="sourceLine" id="cb128-3" data-line-number="3"><span class="kw">select</span>(mtcars,<span class="kw">starts_with</span>(<span class="st">&quot;c&quot;</span>))</a></code></pre></div>
<pre><code>##                     cyl carb
## Mazda RX4             6    4
## Mazda RX4 Wag         6    4
## Datsun 710            4    1
## Hornet 4 Drive        6    1
## Hornet Sportabout     8    2
## Valiant               6    1
## Duster 360            8    4
## Merc 240D             4    2
## Merc 230              4    2
## Merc 280              6    4
## Merc 280C             6    4
## Merc 450SE            8    3
## Merc 450SL            8    3
## Merc 450SLC           8    3
## Cadillac Fleetwood    8    4
## Lincoln Continental   8    4
## Chrysler Imperial     8    4
## Fiat 128              4    1
## Honda Civic           4    2
## Toyota Corolla        4    1
## Toyota Corona         4    1
## Dodge Challenger      8    2
## AMC Javelin           8    2
## Camaro Z28            8    4
## Pontiac Firebird      8    2
## Fiat X1-9             4    1
## Porsche 914-2         4    2
## Lotus Europa          4    2
## Ford Pantera L        8    4
## Ferrari Dino          6    6
## Maserati Bora         8    8
## Volvo 142E            4    2</code></pre>
<p>This example is more realistic in that data frames can have a large number of columns named according to some convention. For example, the measurements on a patient might not be labelled specifically - they might have a common prefix such as “m_” followed by some sequential number (or not).</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">testdf &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">m_1=</span><span class="kw">seq</span>(<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb130-2" data-line-number="2">                      <span class="dt">age=</span><span class="kw">c</span>(<span class="dv">25</span>,<span class="dv">32</span>),</a>
<a class="sourceLine" id="cb130-3" data-line-number="3">                      <span class="dt">m_2=</span><span class="kw">seq</span>(<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb130-4" data-line-number="4">                      <span class="dt">m_3=</span><span class="kw">seq</span>(<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">10</span>))</a></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">testdf</a></code></pre></div>
<pre><code>##    m_1 age m_2 m_3
## 1   60  25  50  60
## 2   70  25  50  60
## 3   60  32  50  60
## 4   70  32  50  60
## 5   60  25  60  60
## 6   70  25  60  60
## 7   60  32  60  60
## 8   70  32  60  60
## 9   60  25  50  70
## 10  70  25  50  70
## 11  60  32  50  70
## 12  70  32  50  70
## 13  60  25  60  70
## 14  70  25  60  70
## 15  60  32  60  70
## 16  70  32  60  70</code></pre>
<p>Find all the columns that include a &quot;_&quot; character</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="kw">select</span>(testdf,<span class="kw">matches</span>(<span class="st">&quot;_&quot;</span>))</a></code></pre></div>
<pre><code>##    m_1 m_2 m_3
## 1   60  50  60
## 2   70  50  60
## 3   60  50  60
## 4   70  50  60
## 5   60  60  60
## 6   70  60  60
## 7   60  60  60
## 8   70  60  60
## 9   60  50  70
## 10  70  50  70
## 11  60  50  70
## 12  70  50  70
## 13  60  60  70
## 14  70  60  70
## 15  60  60  70
## 16  70  60  70</code></pre>
<p>This will select columns beginning with “m_” but only those with a suffx of 1 or 2.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw">select</span>(testdf,<span class="kw">num_range</span>(<span class="st">&quot;m_&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>##    m_1 m_2
## 1   60  50
## 2   70  50
## 3   60  50
## 4   70  50
## 5   60  60
## 6   70  60
## 7   60  60
## 8   70  60
## 9   60  50
## 10  70  50
## 11  60  50
## 12  70  50
## 13  60  60
## 14  70  60
## 15  60  60
## 16  70  60</code></pre>
</div>
<div id="group_by" class="section level3">
<h3><span class="header-section-number">3.3.5</span> group_by()</h3>
<p>The <strong>group_by()</strong> function let’s you organize a data frame by some factor or grouping variable. This a very powerful function that is typically used in conjunction with a function called <strong>summarize</strong>. Here is what it looks like by itself. It’s somewhat underwhelming. It does seem to create table of some kind but it doesn’t do much else.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1">df</a></code></pre></div>
<pre><code>##   id gender age
## 1  1   MALE  70
## 2  2   MALE  76
## 3  3 FEMALE  60
## 4  4   MALE  64
## 5  5 FEMALE  68</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="co"># Hmm. the following doesn&#39;t do anything - or so it seems</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2"></a>
<a class="sourceLine" id="cb139-3" data-line-number="3"><span class="kw">group_by</span>(df)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##      id gender   age
##   &lt;int&gt; &lt;fct&gt;  &lt;dbl&gt;
## 1     1 MALE      70
## 2     2 MALE      76
## 3     3 FEMALE    60
## 4     4 MALE      64
## 5     5 FEMALE    68</code></pre>
<p>So as mentioned, the <strong>group_by</strong> function is usually paired with the <strong>summarize</strong> function. Ah. so what this does is to first group the data frame by the <strong>gender</strong> column and then it <strong>counts</strong> the number of occurrences therein. So this is a form of aggregation.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="kw">summarize</span>(<span class="kw">group_by</span>(df,gender),<span class="dt">total=</span><span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender total
##   &lt;fct&gt;  &lt;int&gt;
## 1 FEMALE     2
## 2 MALE       3</code></pre>
<p><img src="figures/grp.png" /></p>
<p>Let’s group the data frame by gender and then compute the average age for each group.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="kw">summarize</span>(<span class="kw">group_by</span>(df,gender),<span class="dt">av_age=</span><span class="kw">mean</span>(age))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender av_age
##   &lt;fct&gt;   &lt;dbl&gt;
## 1 FEMALE     64
## 2 MALE       70</code></pre>
<p><img src="figures/grpa.png" /></p>
<p>Let’s group by gender and then compute the total number of observations in each gender group and then compute the mean age.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">summarize</span>(<span class="kw">group_by</span>(df,gender),<span class="dt">av_age=</span><span class="kw">mean</span>(age),<span class="dt">total=</span><span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   gender av_age total
##   &lt;fct&gt;   &lt;dbl&gt; &lt;int&gt;
## 1 FEMALE     64     2
## 2 MALE       70     3</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="digging-in.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["nursing_741.pdf", "nursing_741.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
