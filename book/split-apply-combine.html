<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Split Apply Combine | Intro To dplyr</title>
  <meta name="description" content="An Intro to data manipulation with dplyr" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Split Apply Combine | Intro To dplyr" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An Intro to data manipulation with dplyr" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Split Apply Combine | Intro To dplyr" />
  
  <meta name="twitter:description" content="An Intro to data manipulation with dplyr" />
  

<meta name="author" content="Steve Pittard" />


<meta name="date" content="2020-01-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-tidyverse.html"/>
<link rel="next" href="merging-data-frames.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro To dplyr</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> R Data Structures</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#vectors"><i class="fa fa-check"></i><b>1.1</b> Vectors</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-frames"><i class="fa fa-check"></i><b>1.2</b> Data Frames</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#a-reference-data-frame"><i class="fa fa-check"></i><b>1.3</b> A Reference Data Frame</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#relation-to-dplyr"><i class="fa fa-check"></i><b>1.4</b> Relation to dplyr</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="digging-in.html"><a href="digging-in.html"><i class="fa fa-check"></i><b>2</b> Digging In</a><ul>
<li class="chapter" data-level="2.1" data-path="digging-in.html"><a href="digging-in.html#structure"><i class="fa fa-check"></i><b>2.1</b> Structure</a></li>
<li class="chapter" data-level="2.2" data-path="digging-in.html"><a href="digging-in.html#meta-information"><i class="fa fa-check"></i><b>2.2</b> Meta Information</a></li>
<li class="chapter" data-level="2.3" data-path="digging-in.html"><a href="digging-in.html#printing"><i class="fa fa-check"></i><b>2.3</b> Printing</a></li>
<li class="chapter" data-level="2.4" data-path="digging-in.html"><a href="digging-in.html#accessing-rows-and-columns"><i class="fa fa-check"></i><b>2.4</b> Accessing Rows And Columns</a></li>
<li class="chapter" data-level="2.5" data-path="digging-in.html"><a href="digging-in.html#interrogation"><i class="fa fa-check"></i><b>2.5</b> Interrogation</a></li>
<li class="chapter" data-level="2.6" data-path="digging-in.html"><a href="digging-in.html#missing-values"><i class="fa fa-check"></i><b>2.6</b> Missing values</a></li>
<li class="chapter" data-level="2.7" data-path="digging-in.html"><a href="digging-in.html#continuous-vs-factors"><i class="fa fa-check"></i><b>2.7</b> Continuous vs Factors</a></li>
<li class="chapter" data-level="2.8" data-path="digging-in.html"><a href="digging-in.html#sorting-data"><i class="fa fa-check"></i><b>2.8</b> Sorting data</a></li>
<li class="chapter" data-level="2.9" data-path="digging-in.html"><a href="digging-in.html#reading-csv-files"><i class="fa fa-check"></i><b>2.9</b> Reading CSV Files</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-tidyverse.html"><a href="the-tidyverse.html"><i class="fa fa-check"></i><b>3</b> The tidyverse</a><ul>
<li class="chapter" data-level="3.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#installing"><i class="fa fa-check"></i><b>3.1</b> Installing</a></li>
<li class="chapter" data-level="3.2" data-path="the-tidyverse.html"><a href="the-tidyverse.html#dplyr-basics"><i class="fa fa-check"></i><b>3.2</b> dplyr Basics</a></li>
<li class="chapter" data-level="3.3" data-path="the-tidyverse.html"><a href="the-tidyverse.html#first-steps"><i class="fa fa-check"></i><b>3.3</b> First Steps</a><ul>
<li class="chapter" data-level="3.3.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#filter"><i class="fa fa-check"></i><b>3.3.1</b> filter()</a></li>
<li class="chapter" data-level="3.3.2" data-path="the-tidyverse.html"><a href="the-tidyverse.html#mutate"><i class="fa fa-check"></i><b>3.3.2</b> mutate()</a></li>
<li class="chapter" data-level="3.3.3" data-path="the-tidyverse.html"><a href="the-tidyverse.html#arrange"><i class="fa fa-check"></i><b>3.3.3</b> arrange()</a></li>
<li class="chapter" data-level="3.3.4" data-path="the-tidyverse.html"><a href="the-tidyverse.html#select"><i class="fa fa-check"></i><b>3.3.4</b> select()</a></li>
<li class="chapter" data-level="3.3.5" data-path="the-tidyverse.html"><a href="the-tidyverse.html#group_by"><i class="fa fa-check"></i><b>3.3.5</b> group_by()</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="split-apply-combine.html"><a href="split-apply-combine.html"><i class="fa fa-check"></i><b>4</b> Split Apply Combine</a><ul>
<li class="chapter" data-level="4.1" data-path="split-apply-combine.html"><a href="split-apply-combine.html#what-are-pipes"><i class="fa fa-check"></i><b>4.1</b> What Are Pipes ?</a></li>
<li class="chapter" data-level="4.2" data-path="split-apply-combine.html"><a href="split-apply-combine.html#using-pipes-to-do-split-apply-combine"><i class="fa fa-check"></i><b>4.2</b> Using Pipes To Do Split-Apply-Combine</a><ul>
<li class="chapter" data-level="4.2.1" data-path="split-apply-combine.html"><a href="split-apply-combine.html#saving-results"><i class="fa fa-check"></i><b>4.2.1</b> Saving Results</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="split-apply-combine.html"><a href="split-apply-combine.html#an-example"><i class="fa fa-check"></i><b>4.3</b> An Example</a></li>
<li class="chapter" data-level="4.4" data-path="split-apply-combine.html"><a href="split-apply-combine.html#working-with-flowers"><i class="fa fa-check"></i><b>4.4</b> Working With Flowers</a><ul>
<li class="chapter" data-level="4.4.1" data-path="split-apply-combine.html"><a href="split-apply-combine.html#structure-of-the-data-frame"><i class="fa fa-check"></i><b>4.4.1</b> Structure of The Data frame</a></li>
<li class="chapter" data-level="4.4.2" data-path="split-apply-combine.html"><a href="split-apply-combine.html#more-practice"><i class="fa fa-check"></i><b>4.4.2</b> More Practice</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="merging-data-frames.html"><a href="merging-data-frames.html"><i class="fa fa-check"></i><b>5</b> Merging Data Frames</a><ul>
<li class="chapter" data-level="5.1" data-path="merging-data-frames.html"><a href="merging-data-frames.html#using-keys"><i class="fa fa-check"></i><b>5.1</b> Using keys</a></li>
<li class="chapter" data-level="5.2" data-path="merging-data-frames.html"><a href="merging-data-frames.html#full_join"><i class="fa fa-check"></i><b>5.2</b> full_join()</a></li>
<li class="chapter" data-level="5.3" data-path="merging-data-frames.html"><a href="merging-data-frames.html#inner_join"><i class="fa fa-check"></i><b>5.3</b> inner_join()</a></li>
<li class="chapter" data-level="5.4" data-path="merging-data-frames.html"><a href="merging-data-frames.html#left_join"><i class="fa fa-check"></i><b>5.4</b> left_join()</a></li>
<li class="chapter" data-level="5.5" data-path="merging-data-frames.html"><a href="merging-data-frames.html#right_join"><i class="fa fa-check"></i><b>5.5</b> right_join()</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="your-turn.html"><a href="your-turn.html"><i class="fa fa-check"></i><b>6</b> Your Turn</a></li>
<li class="chapter" data-level="7" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html"><i class="fa fa-check"></i><b>7</b> Chicago Crime Data</a><ul>
<li class="chapter" data-level="7.1" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#getting-the-data"><i class="fa fa-check"></i><b>7.1</b> Getting the Data</a></li>
<li class="chapter" data-level="7.2" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#inspecting-the-data"><i class="fa fa-check"></i><b>7.2</b> Inspecting the Data</a></li>
<li class="chapter" data-level="7.3" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#creating-some-dates"><i class="fa fa-check"></i><b>7.3</b> Creating Some Dates</a></li>
<li class="chapter" data-level="7.4" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#count-arrests"><i class="fa fa-check"></i><b>7.4</b> Count Arrests</a></li>
<li class="chapter" data-level="7.5" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#crime-at-day-vs-night"><i class="fa fa-check"></i><b>7.5</b> Crime At Day vs Night</a></li>
<li class="chapter" data-level="7.6" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#line-graphs-and-histograms"><i class="fa fa-check"></i><b>7.6</b> Line Graphs and Histograms</a></li>
<li class="chapter" data-level="7.7" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#calendar-map"><i class="fa fa-check"></i><b>7.7</b> Calendar Map</a></li>
<li class="chapter" data-level="7.8" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#what-types-of-crime-do-we-see"><i class="fa fa-check"></i><b>7.8</b> What Types of Crime Do We See ?</a></li>
<li class="chapter" data-level="7.9" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#creating-a-map"><i class="fa fa-check"></i><b>7.9</b> Creating A Map</a></li>
<li class="chapter" data-level="7.10" data-path="chicago-crime-data.html"><a href="chicago-crime-data.html#leaflet"><i class="fa fa-check"></i><b>7.10</b> Leaflet</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro To dplyr</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="split-apply-combine" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Split Apply Combine</h1>
<p>This pattern of using <strong>group_by()</strong> followed by <strong>summarize()</strong> is called <strong>Split Apply Combine</strong>. The idea is that we</p>
<ol style="list-style-type: decimal">
<li>Split up the data frame by gender group</li>
<li>Then for each group, apply the average function</li>
<li>Then combine the average results for each group</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(<span class="kw">group_by</span>(df,gender),<span class="dt">av_age=</span><span class="kw">mean</span>(age))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender av_age
##   &lt;fct&gt;   &lt;dbl&gt;
## 1 FEMALE     64
## 2 MALE       70</code></pre>
<div class="figure">
<img src="figures/morpheus.png" width="600" />

</div>
<div id="what-are-pipes" class="section level2">
<h2><span class="header-section-number">4.1</span> What Are Pipes ?</h2>
<p>Before moving forward let us consider the “pipe” operator that is included with the dplyr - well actually <strong>magrittr</strong> package. This is used to make it possible to “pipe” the results of one command into another command and so on.</p>
<p>The inspiration for this comes from the UNIX/LINUX operating system where pipes are used all the time. So in effect using “pipes” is nothing new in the world of research computation.</p>
<div class="figure">
<img src="figures/unix_pipe.png" />

</div>
<p><strong>Warning:</strong> Once you get used to pipes it is hard to go back to not using them.</p>
<p>Let’s use the mtcars data frame to illustrate the basics of the piping mechanism as used by dplyr. Here we will select the <strong>mpg</strong> and <strong>am</strong> column from mtcars and view the top 5 rows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">select</span>(mtcars, mpg, am))</code></pre></div>
<pre><code>##                    mpg   am
## Mazda RX4         21.0  Man
## Mazda RX4 Wag     21.0  Man
## Datsun 710        22.8  Man
## Hornet 4 Drive    21.4 Auto
## Hornet Sportabout 18.7 Auto
## Valiant           18.1 Auto</code></pre>
<p>Okay, how would we do this using pipes ? Whoa ! Note that each command is “it’s own thing” independently of the pipe character. So the: - output of mtcars goes into the - input of the <strong>select</strong> function whose output goes into the - input of the <strong>head</strong> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(mpg, am) <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>##                    mpg   am
## Mazda RX4         21.0  Man
## Mazda RX4 Wag     21.0  Man
## Datsun 710        22.8  Man
## Hornet 4 Drive    21.4 Auto
## Hornet Sportabout 18.7 Auto
## Valiant           18.1 Auto</code></pre>
<p>Break this down:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(mpg, am)</code></pre></div>
<pre><code>##                      mpg   am
## Mazda RX4           21.0  Man
## Mazda RX4 Wag       21.0  Man
## Datsun 710          22.8  Man
## Hornet 4 Drive      21.4 Auto
## Hornet Sportabout   18.7 Auto
## Valiant             18.1 Auto
## Duster 360          14.3 Auto
## Merc 240D           24.4 Auto
## Merc 230            22.8 Auto
## Merc 280            19.2 Auto
## Merc 280C           17.8 Auto
## Merc 450SE          16.4 Auto
## Merc 450SL          17.3 Auto
## Merc 450SLC         15.2 Auto
## Cadillac Fleetwood  10.4 Auto
## Lincoln Continental 10.4 Auto
## Chrysler Imperial   14.7 Auto
## Fiat 128            32.4  Man
## Honda Civic         30.4  Man
## Toyota Corolla      33.9  Man
## Toyota Corona       21.5 Auto
## Dodge Challenger    15.5 Auto
## AMC Javelin         15.2 Auto
## Camaro Z28          13.3 Auto
## Pontiac Firebird    19.2 Auto
## Fiat X1-9           27.3  Man
## Porsche 914-2       26.0  Man
## Lotus Europa        30.4  Man
## Ford Pantera L      15.8  Man
## Ferrari Dino        19.7  Man
## Maserati Bora       15.0  Man
## Volvo 142E          21.4  Man</code></pre>
<p>The key to understanding how this works is to <strong>read</strong> this from left to right. It bears repeating that each command is “it’s own thing” independently of the pipe character. So the:</p>
<pre><code>- output of mtcars goes into the 
- input of the **select** function whose output goes into the
- input of the **head** function</code></pre>
<p>Let’s use our new found knowledge to re-imagine our use of the <strong>group_by</strong> and <strong>summarize</strong> functions that we have been using in <strong>composite</strong> form up until now.</p>
</div>
<div id="using-pipes-to-do-split-apply-combine" class="section level2">
<h2><span class="header-section-number">4.2</span> Using Pipes To Do Split-Apply-Combine</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">avg=</span><span class="kw">mean</span>(age))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender   avg
##   &lt;fct&gt;  &lt;dbl&gt;
## 1 FEMALE    64
## 2 MALE      70</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Same as the following but the pipes don&#39;t require you to &quot;commit&quot;</span>
<span class="co"># With the following, you have to know in advance what you want to do</span>

<span class="kw">summarize</span>(<span class="kw">group_by</span>(df,gender), <span class="dt">avg=</span><span class="kw">mean</span>(age))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender   avg
##   &lt;fct&gt;  &lt;dbl&gt;
## 1 FEMALE    64
## 2 MALE      70</code></pre>
<p>This approach allows us to build a “pipeline” containing commands. We don’t have to commit to a specific sequence of functions. This enables a free-form type of exploration.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg=</span><span class="kw">mean</span>(age),<span class="dt">total=</span><span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   gender   avg total
##   &lt;fct&gt;  &lt;dbl&gt; &lt;int&gt;
## 1 FEMALE    64     2
## 2 MALE      70     3</code></pre>
<p>What is the median age of all males ?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;MALE&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">med_age=</span><span class="kw">median</span>(age))</code></pre></div>
<pre><code>##   med_age
## 1      70</code></pre>
<div class="figure">
<img src="figures/chrt.png" />

</div>
<div id="saving-results" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Saving Results</h3>
<p>It should be observed that if you want to save the results of some sequence of commands that you will need to use the “&lt;-” operator. Using the previous example we could the following to save our result.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;MALE&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">summarize</span>(<span class="dt">med_age=</span><span class="kw">median</span>(age))</code></pre></div>
</div>
</div>
<div id="an-example" class="section level2">
<h2><span class="header-section-number">4.3</span> An Example</h2>
<p>Using the built in mtcars dataframe, do the following:</p>
<ol style="list-style-type: decimal">
<li><p><strong>filter</strong> for records where the wt is greater than 3.3 tons.</p></li>
<li><p>Then, using the <strong>mutate</strong> function to create a column called ab_be (Y or N) that indicates whether that observation’s mpg is greater (or not) than the average mpg for the filtered set.</p></li>
<li><p>Then present the average mpg for each group.</p></li>
</ol>
<p>This is easy using pipes and dplyr verbs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(wt <span class="op">&gt;</span><span class="st"> </span><span class="fl">3.3</span>)  <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw">mutate</span>(<span class="dt">ab_be=</span><span class="kw">ifelse</span>(mpg <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(mpg),<span class="st">&quot;Y&quot;</span>,<span class="st">&quot;N&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw">group_by</span>(ab_be) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">           </span><span class="kw">summarize</span>(<span class="dt">mean_mpg=</span><span class="kw">mean</span>(mpg))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   ab_be mean_mpg
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 N         13.8
## 2 Y         18.1</code></pre>
<p>This could be then “piped” into the input of the <strong>ggplot</strong> command to plot a corresponding bar chart. If you don’t yet know ggplot then it’s okay as this will nudge you in that direction. Both <strong>ggplot</strong> and <strong>dplyr</strong> are part of the <strong>tidyverse</strong> which means that the two packages “talk” to each other well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(wt <span class="op">&gt;</span><span class="st"> </span><span class="fl">3.3</span>)  <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw">mutate</span>(<span class="dt">ab_be=</span><span class="kw">ifelse</span>(mpg <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(mpg),<span class="st">&quot;Y&quot;</span>,<span class="st">&quot;N&quot;</span>)  ) <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw">group_by</span>(ab_be) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_mpg=</span><span class="kw">mean</span>(mpg)) <span class="op">%&gt;%</span>
<span class="st">           </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>ab_be,<span class="dt">y=</span>mean_mpg)) <span class="op">+</span>
<span class="st">           </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">           </span><span class="kw">ggtitle</span>(<span class="st">&quot;Mean MPG&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;ab_be&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Mean MPG&quot;</span>)</code></pre></div>
<p><img src="nursing_741_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
</div>
<div id="working-with-flowers" class="section level2">
<h2><span class="header-section-number">4.4</span> Working With Flowers</h2>
<p>Let’s work with the built in <strong>iris</strong> data frame to explore the world of flowers. This is famous (Fisher’s or Anderson’s) <strong>iris</strong> data set gives the measurements in centimeters of the variables sepal length and width and petal length and width, respectively, for 50 flowers from each of 3 species of iris. The species are Iris setosa, versicolor, and virginica.</p>
<p>I’ll use dyplr idioms here as opposed to the typical Base R approach which might involve use of composite functions. First, load up the iris data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(iris)</code></pre></div>
<div id="structure-of-the-data-frame" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Structure of The Data frame</h3>
<p>It’s always helpful to look at what types of data you have in a data frame. As you already known, base R has a function called <strong>str</strong> which is useful. The tidyverse equivalent is <strong>glimpse</strong> although the two commands basically provide the same types of information. Personally, I still prefer the “old” <strong>str</strong> function if only because I’ve been using it for so long.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(iris)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(iris)</code></pre></div>
<pre><code>## Observations: 150
## Variables: 5
## $ Sepal.Length &lt;dbl&gt; 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5…
## $ Sepal.Width  &lt;dbl&gt; 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3…
## $ Petal.Length &lt;dbl&gt; 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1…
## $ Petal.Width  &lt;dbl&gt; 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0…
## $ Species      &lt;fct&gt; setosa, setosa, setosa, setosa, setosa, setosa, set…</code></pre>
</div>
<div id="more-practice" class="section level3">
<h3><span class="header-section-number">4.4.2</span> More Practice</h3>
<ol style="list-style-type: decimal">
<li>Get all the rows where the Species is “setosa” Sepal.Length is &gt; 4.7 but &lt; 5.0. Use the pipes feature to help you with this.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Sepal.Length <span class="op">&gt;</span><span class="st"> </span><span class="fl">4.7</span> <span class="op">&amp;</span><span class="st"> </span>Sepal.Length <span class="op">&lt;</span><span class="st"> </span><span class="fl">5.0</span> <span class="op">&amp;</span><span class="st"> </span>Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span> )</code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          4.9         3.0          1.4         0.2  setosa
## 2          4.9         3.1          1.5         0.1  setosa
## 3          4.8         3.4          1.6         0.2  setosa
## 4          4.8         3.0          1.4         0.1  setosa
## 5          4.8         3.4          1.9         0.2  setosa
## 6          4.8         3.1          1.6         0.2  setosa
## 7          4.9         3.1          1.5         0.2  setosa
## 8          4.9         3.6          1.4         0.1  setosa
## 9          4.8         3.0          1.4         0.3  setosa</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Select out only the columns relating Sepal measurements. List only the top five rows:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">c</span>(Sepal.Length,Sepal.Width)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width
## 1          5.1         3.5
## 2          4.9         3.0
## 3          4.7         3.2
## 4          4.6         3.1
## 5          5.0         3.6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Or use a helper function to process strings</span>

iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;Sepal&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width
## 1          5.1         3.5
## 2          4.9         3.0
## 3          4.7         3.2
## 4          4.6         3.1
## 5          5.0         3.6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Or if you know which column numbers you want</span>

iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width
## 1          5.1         3.5
## 2          4.9         3.0
## 3          4.7         3.2
## 4          4.6         3.1
## 5          5.0         3.6</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Sort the data frame by Sepal.Width such that the row with the largest Sepal.Width is listed first. Print only the first 5 rows</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Sepal.Width)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.7         4.4          1.5         0.4  setosa
## 2          5.5         4.2          1.4         0.2  setosa
## 3          5.2         4.1          1.5         0.1  setosa
## 4          5.8         4.0          1.2         0.2  setosa
## 5          5.4         3.9          1.7         0.4  setosa</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>How many observations are there for each Species group ?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>()</code></pre></div>
<pre><code>## # A tibble: 3 x 2
## # Groups:   Species [3]
##   Species        n
##   &lt;fct&gt;      &lt;int&gt;
## 1 setosa        50
## 2 versicolor    50
## 3 virginica     50</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Or</span>

iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">total=</span><span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Species    total
##   &lt;fct&gt;      &lt;int&gt;
## 1 setosa        50
## 2 versicolor    50
## 3 virginica     50</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Select all columns that do NOT relate to Length. Limit output to 5 rows</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">ends_with</span>(<span class="st">&quot;Length&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##   Sepal.Width Petal.Width Species
## 1         3.5         0.2  setosa
## 2         3.0         0.2  setosa
## 3         3.2         0.2  setosa
## 4         3.1         0.2  setosa
## 5         3.6         0.2  setosa
## 6         3.9         0.4  setosa</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Select all columns that do NOT relate to Length or Species. Limit output to 5 rows</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(<span class="kw">ends_with</span>(<span class="st">&quot;Length&quot;</span>),<span class="st">&quot;Species&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##   Sepal.Width Petal.Width
## 1         3.5         0.2
## 2         3.0         0.2
## 3         3.2         0.2
## 4         3.1         0.2
## 5         3.6         0.2
## 6         3.9         0.4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Or</span>

iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">ends_with</span>(<span class="st">&quot;Length&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="st">&quot;Species&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##   Sepal.Width Petal.Width
## 1         3.5         0.2
## 2         3.0         0.2
## 3         3.2         0.2
## 4         3.1         0.2
## 5         3.6         0.2
## 6         3.9         0.4</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Select all columns that do NOT relate to Length or Species. But only for observations where Sepal.Width is &gt; 3.9. There are multiples way to attack this problem.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Sepal.Width <span class="op">&gt;</span><span class="st"> </span><span class="fl">3.9</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">ends_with</span>(<span class="st">&quot;Length&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">&quot;Species&quot;</span>)</code></pre></div>
<pre><code>##   Sepal.Width Petal.Width
## 1         4.0         0.2
## 2         4.4         0.4
## 3         4.1         0.1
## 4         4.2         0.2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Or</span>

iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">ends_with</span>(<span class="st">&quot;Length&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">&quot;Species&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Sepal.Width <span class="op">&gt;</span><span class="st"> </span><span class="fl">3.9</span>) </code></pre></div>
<pre><code>##   Sepal.Width Petal.Width
## 1         4.0         0.2
## 2         4.4         0.4
## 3         4.1         0.1
## 4         4.2         0.2</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Determine the mean, standard deviation, max, and min for Sepal.Length</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean=</span><span class="kw">mean</span>(Sepal.Length),
                   <span class="dt">sd=</span><span class="kw">sd</span>(Sepal.Length),
                   <span class="dt">max=</span><span class="kw">max</span>(Sepal.Length),
                   <span class="dt">min=</span><span class="kw">min</span>(Sepal.Length))</code></pre></div>
<pre><code>##       mean        sd max min
## 1 5.843333 0.8280661 7.9 4.3</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>For each Species type, determine the mean, standard deviation, max, and min for Sepal.Length</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean=</span><span class="kw">mean</span>(Sepal.Length),
                                         <span class="dt">sd=</span><span class="kw">sd</span>(Sepal.Length),
                                         <span class="dt">max=</span><span class="kw">max</span>(Sepal.Length),
                                         <span class="dt">min=</span><span class="kw">min</span>(Sepal.Length))</code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Species     mean    sd   max   min
##   &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 setosa      5.01 0.352   5.8   4.3
## 2 versicolor  5.94 0.516   7     4.9
## 3 virginica   6.59 0.636   7.9   4.9</code></pre>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-tidyverse.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="merging-data-frames.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["nursing_741.pdf", "nursing_741.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
